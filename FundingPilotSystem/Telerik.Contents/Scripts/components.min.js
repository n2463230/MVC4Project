$t.selectbox=function(n,t){function o(){i.$items||i.dataBind(t.data)}function f(n){e.html(n?n:"&nbsp;")}function s(n){var r,e,s;for(o(),r=-1,e=0,s=t.data.length;e<s;e++)if(t.data[e].Value==n){r=e;break}r!=-1&&(i.$items.removeClass("t-state-selected").eq(r).addClass("t-state-selected"),f($(i.$items[r]).text()),u=t.data[r].Value)}var u,r=$(n).attr("tabIndex",0),e=r.find(".t-input"),i=this.dropDown=new $t.dropDown({effects:$t.fx.slide.defaults(),onItemCreate:t.onItemCreate,onClick:function(n){s(t.data[$(n.item).index()].Value);t.onChange({value:u})}});this.value=function(n){if(n==undefined)return u;s(n),u!=n&&f(t.title||n)},this.close=function(){i.close()},f(t.title||e.text()),r.click(function(){o(),i.isOpened()?i.close():i.open({offset:r.offset(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth(),zIndex:$t.getElementZIndex(r[0])})}).find("*").attr("unselectable","on").end().keydown(function(n){var u=n.keyCode,t,f,e;u===40?(i.isOpened()?(t=i.$items.filter(".t-state-selected"),e=t[0]?t.next():i.$items.first(),e[0]&&(t.removeClass("t-state-selected"),e.addClass("t-state-selected"))):r.click(),n.preventDefault()):u===38?(i.isOpened()&&(t=i.$items.filter(".t-state-selected"),f=t.prev(),f[0]&&(t.removeClass("t-state-selected"),f.addClass("t-state-selected"))),n.preventDefault()):u==13?(t=i.$items.filter(".t-state-selected"),t[0]&&t.click(),n.preventDefault()):(n.keyCode==9||n.keyCode==39||n.keyCode==37)&&i.close()}),$.browser.msie&&r.focus(function(){r.css("outline","1px dotted #000")}).blur(function(){r.css("outline","")}),i.$element.css("direction",r.closest(".t-rtl").length>0?"rtl":""),$(document.documentElement).bind("mousedown",$.proxy(function(t){var r=i.$element,u=r&&r.parent().length>0;!u||$.contains(n,t.target)||$.contains(r.parent()[0],t.target)||i.close()},this))},$.fn.tSelectBox=function(n){return $t.create(this,{name:"tSelectBox",init:function(n,t){return new $t.selectbox(n,t)},options:n})},$.fn.tSelectBox.defaults={effects:$t.fx.slide.defaults()},$t.colorpicker=function(n,t){var i=this,r;i.element=n,r=$(n),$.extend(i,t),r.attr("tabIndex",0).click($.proxy(i.click,i)).keydown(function(n){var r=i.popup(),t,u,f;n.keyCode==40?(r.is(":visible")?(t=r.find(".t-state-selected"),u=t[0]?t.next():r.find("li:first"),u[0]&&(t.removeClass("t-state-selected"),u.addClass("t-state-selected"))):i.open(),n.preventDefault()):n.keyCode==38?(r.is(":visible")&&(t=r.find(".t-state-selected"),f=t.prev(),f[0]&&(t.removeClass("t-state-selected"),f.addClass("t-state-selected"))),n.preventDefault()):n.keyCode==9||n.keyCode==39||n.keyCode==37?i.close():n.keyCode==13&&(r.find(".t-state-selected").click(),n.preventDefault())}).find("*").attr("unselectable","on"),$.browser.msie&&r.focus(function(){r.css("outline","1px dotted #000")}).blur(function(){r.css("outline","")}),i.selectedColor&&r.find(".t-selected-color").css("background-color",this.selectedColor),$(n.ownerDocument.documentElement).bind("mousedown",$.proxy(function(n){$(n.target).closest(".t-colorpicker-popup").length||this.close()},i)),$t.bind(i,{change:i.onChange,load:i.onLoad})},$t.colorpicker.prototype={select:function(n){n?(n=dom.toHex(n),$t.trigger(this.element,"change",{value:n})||(this.value(n),this.close())):$t.trigger(this.element,"change",{value:this.selectedColor})},open:function(){var i=this.popup(),t=$(this.element),r=t.offset(),n;r.top+=t.outerHeight(),t.closest(".t-rtl").length&&(r.left-=i.outerWidth()-t.outerWidth()),n="auto",t.parents().andSelf().each(function(){return n=$(this).css("zIndex"),Number(n)?(n=Number(n)+1,!1):void 0}),$t.fx._wrap(i).css($.extend({position:"absolute",zIndex:n},r)),i.find(".t-item").bind("click",$.proxy(function(n){var t=$(n.currentTarget,n.target.ownerDocument).find("div").css("background-color");this.select(t)},this)),$t.fx.play(this.effects,i,{direction:"bottom"})},close:function(){this.$popup&&$t.fx.rewind(this.effects,this.$popup,{direction:"bottom"},$.proxy(function(){dom.remove(this.$popup[0].parentNode),this.$popup=null},this))},toggle:function(){this.$popup&&this.$popup.is(":visible")?this.close():this.open()},click:function(n){$(n.target).closest(".t-tool-icon").length>0?this.select():this.toggle()},value:function(n){if(!n)return this.selectedColor;n=dom.toHex(n),this.selectedColor=n,$(".t-selected-color",this.element).css("background-color",n)},popup:function(){return this.$popup||(this.$popup=$($t.colorpicker.buildPopup(this)).hide().appendTo(document.body).find("*").attr("unselectable","on").end()),this.$popup}},$.extend($t.colorpicker,{buildPopup:function(n){var i=new $t.stringBuilder,r,u,t,f;for(i.cat('<div class="t-popup t-group t-colorpicker-popup">').cat('<ul class="t-reset">'),r=n.data,u=(n.value()||"").substring(1),t=0,f=r.length;t<f;t++)i.cat('<li class="t-item').catIf(" t-state-selected",r[t]==u).cat('"><div style="background-color:#').cat(r[t]).cat('"><\/div><\/li>');return i.cat("<\/ul><\/div>"),i.string()}}),$.fn.tColorPicker=function(n){return $t.create(this,{name:"tColorPicker",init:function(n,t){return new $t.colorpicker(n,t)},options:n})},$.fn.tColorPicker.defaults={data:"000000,7f7f7f,880015,ed1c24,ff7f27,fff200,22b14c,00a2e8,3f48cc,a349a4,ffffff,c3c3c3,b97a57,ffaec9,ffc90e,efe4b0,b5e61d,99d9ea,7092be,c8bfe7".split(","),selectedColor:null,effects:$t.fx.slide.defaults()};