function createContentElement(n,t){n.hide();var r=$("<iframe />",{src:'javascript:"<html><\/html>"',frameBorder:"0"}).css("display","").addClass("t-content").insertBefore(n)[0],f=r.contentWindow||r,i=f.document||r.contentDocument,u=n.val().replace(/(<\/?img[^>]*>)[\r\n\v\f\t ]+/ig,"$1").replace(/[\r\n\v\f\t ]+/ig," ");return!u.length&&$.browser.mozilla&&(u='<br _moz_dirty="true" />'),i.designMode="On",i.open(),i.write((new $t.stringBuilder).cat("<!DOCTYPE html><html><head>").cat('<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />').cat('<style type="text/css">').cat("html,body{padding:0;margin:0;font-family:Verdana,Geneva,sans-serif;background:#fff;}").cat("html{font-size:100%}body{font-size:.75em;line-height:1.5;padding-top:1px;margin-top:-1px;").catIf("direction:rtl;",n.closest(".t-rtl").length).cat("}").cat("h1{font-size:2em;margin:.67em 0}h2{font-size:1.5em}h3{font-size:1.16em}h4{font-size:1em}h5{font-size:.83em}h6{font-size:.7em}").cat("p{margin:0 0 1em;padding:0 .2em}.t-marker{display:none;}.t-paste-container{position:absolute;left:-10000px;width:1px;height:1px;overflow:hidden}").cat("ul,ol{padding-left:2.5em}").cat("a{color:#00a}").cat("code{font-size:1.23em}").cat("<\/style>").cat($.map(t,function(n){return['<link type="text/css" href="',n,'" rel="stylesheet"/>'].join("")}).join("")).cat('<\/head><body spellcheck="false">').cat(u).cat("<\/body><\/html>").string()),i.close(),f}function selectionChanged(n){$t.trigger(n.element,"selectionChange")}function initializeContentElement(n){var t=!0;n.window=createContentElement($(n.textarea),n.stylesheets),n.document=n.window.contentDocument||n.window.document,n.body=n.document.body,$(n.document).bind({keydown:function(i){var r,u;if(i.keyCode===121){setTimeout(function(){var t=$(n.element).attr("tabIndex");$(n.element).attr("tabIndex",t||0).focus().find(focusable).first().focus(),t||t===0||$(n.element).removeAttr("tabIndex")},100),i.preventDefault();return}if(r=n.keyboard.toolFromShortcut(n.tools,i),r)return i.preventDefault(),/undo|redo/.test(r)||n.keyboard.endTyping(!0),n.exec(r),!1;n.keyboard.isTypingKey(i)&&n.pendingFormats.hasPending()&&(t?t=!1:(u=n.getRange(),n.pendingFormats.apply(u),n.selectRange(u))),n.keyboard.clearTimeout(),n.keyboard.keydown(i)},keyup:function(i){var r;$.browser.mozilla&&i.keyCode==8&&fixBackspace(n,i),($.inArray(i.keyCode,[8,9,33,34,35,36,37,38,39,40,40,45,46])>-1||i.keyCode==65&&i.ctrlKey&&!i.altKey&&!i.shiftKey)&&(n.pendingFormats.clear(),selectionChanged(n)),n.keyboard.isTypingKey(i)?n.pendingFormats.hasPending()&&(r=n.getRange(),n.pendingFormats.apply(r),n.selectRange(r)):t=!0,n.keyboard.keyup(i)},mousedown:function(t){n.pendingFormats.clear();var i=$(t.target);!$.browser.gecko&&t.which==2&&i.is("a[href]")&&window.open(i.attr("href"),"_new")},mouseup:function(){selectionChanged(n)}}),$(n.window).bind("blur",function(){var i=n.textarea.value,t=n.encodedValue();n.update(t),t!=i&&$t.trigger(n.element,"change")}),$(n.body).bind("cut paste",function(t){n.clipboard["on"+t.type](t)})}function fixBackspace(n,t){var u=n.getRange(),r=u.startContainer,i,f,e;if(r!=n.body.firstChild&&dom.isBlock(r)&&(!(r.childNodes.length>0)||r.childNodes.length==1&&dom.is(r.firstChild,"br"))){for(i=r.previousSibling;i&&!dom.isBlock(i);)i=i.previousSibling;if(i){for(f=n.document.createTreeWalker(i,NodeFilter.SHOW_TEXT,null,!1);e=f.nextNode();)i=e;u.setStart(i,isDataNode(i)?i.nodeValue.length:0),u.collapse(!0),selectRange(u),dom.remove(r),t.preventDefault()}}}function formatByName(n,t){for(var i=0;i<t.length;i++)if($.inArray(n,t[i].tags)>=0)return t[i]}function Tool(n){$.extend(this,n),this.init=function(n,t){n.attr({unselectable:"on",title:t.title})},this.command=function(t){return new n.command(t)},this.update=function(){},this.willDelayExecution=function(){return!1}}function FormatTool(n){Tool.call(this,n),this.command=function(t){return new FormatCommand($.extend(t,{formatter:n.formatter}))},this.update=function(t,i,r){var f=r.isPending(this.name),u=n.finder.isFormatted(i),e=f?!u:u;t.toggleClass("t-state-active",e)}}var focusable=".t-colorpicker,a.t-tool-icon:not(.t-state-disabled),.t-selectbox, .t-combobox .t-input",formats,emptyFinder,localization;$t.editor=function(n,t){function f(n){var t=$.grep(n.className.split(" "),function(n){return!/^t-(widget|tool-icon|state-hover|header|combobox|dropdown|selectbox|colorpicker)$/i.test(n)});return t[0]?t[0].substring(2):"custom"}function h(n,t){return t.key?(new $t.stringBuilder).cat(n).cat(" (").catIf("Ctrl + ",t.ctrl).catIf("Shift + ",t.shift).catIf("Alt + ",t.alt).cat(t.key).cat(")").string():n}var i,r,u;if(!/Mobile.*Safari/.test(navigator.userAgent)){i=this,this.element=n,r=$(n),r.closest("form").bind("submit",function(){i.update()}),$.extend(this,t),$t.bind(this,{load:this.onLoad,selectionChange:this.onSelectionChange,change:this.onChange,execute:this.onExecute,error:this.onError,paste:this.onPaste});for(u in this.tools)this.tools[u].name=u.toLowerCase();this.textarea=r.find("textarea").attr("autocomplete","off")[0],initializeContentElement(this),this.keyboard=new Keyboard([new TypingHandler(this),new SystemHandler(this)]),this.clipboard=new Clipboard(this),this.pendingFormats=new PendingFormats(this),this.undoRedoStack=new UndoRedoStack;var s=".t-editor-toolbar > li > *",e=".t-editor-button .t-tool-icon",o=e+":not(.t-state-disabled)",c=e+".t-state-disabled";r.find(".t-combobox .t-input").keydown(function(n){var t=$(this).closest(".t-combobox").data("tComboBox"),i=n.keyCode;i==39||i==37?t.close():i==40&&(t.dropDown.isOpened()||(n.stopImmediatePropagation(),t.open()))}),r.delegate(o,"mouseenter",$t.hover).delegate(o,"mouseleave",$t.leave).delegate(e,"mousedown",$t.preventDefault).delegate(focusable,"keydown",function(n){n.keyCode==39?$(this).closest("li").nextAll("li:has("+focusable+")").first().find(focusable).focus():n.keyCode==37?$(this).closest("li").prevAll("li:has("+focusable+")").last().find(focusable).focus():n.keyCode==27&&i.focus()}).delegate(o,"click",$t.stopAll(function(){i.exec(f(this))})).delegate(c,"click",function(n){n.preventDefault()}).find(s).each(function(){var n=f(this),r=i.tools[n],e=i.localization[n],u=$(this),t;r&&((n=="fontSize"||n=="fontName")&&(t=i.localization[n+"Inherit"]||localization[n+"Inherit"],i[n][0].Text=t,u.find("input").val(t).end().find("span.t-input").text(t).end()),r.init(u,{title:h(e,r),editor:i}))}).end().bind("selectionChange",function(){var t=i.getRange(),n=textNodes(t);n.length||(n=[t.startContainer]),r.find(s).each(function(){var t=i.tools[f(this)];t&&t.update($(this),n,i.pendingFormats)})}),$(document).bind("DOMNodeInserted",function(n){($.contains(n.target,i.element)||i.element==n.target)&&(i.textarea.value=i.value(),$(i.element).find("iframe").remove(),initializeContentElement(i))}).bind("mousedown",function(){try{i.keyboard.typingInProgress()&&i.keyboard.endTyping(!0),i.selectionRestorePoint||(i.selectionRestorePoint=new RestorePoint(i.getRange()))}catch(e){}})}},$.extend($t.editor,{BlockFormatFinder:BlockFormatFinder,BlockFormatter:BlockFormatter,Dom:dom,FormatCommand:FormatCommand,GenericCommand:GenericCommand,GreedyBlockFormatter:GreedyBlockFormatter,GreedyInlineFormatFinder:GreedyInlineFormatFinder,GreedyInlineFormatter:GreedyInlineFormatter,ImageCommand:ImageCommand,IndentCommand:IndentCommand,IndentFormatter:IndentFormatter,InlineFormatFinder:InlineFormatFinder,InlineFormatter:InlineFormatter,InsertHtmlCommand:InsertHtmlCommand,Keyboard:Keyboard,LinkCommand:LinkCommand,LinkFormatFinder:LinkFormatFinder,LinkFormatter:LinkFormatter,ListCommand:ListCommand,ListFormatFinder:ListFormatFinder,ListFormatter:ListFormatter,MSWordFormatCleaner:MSWordFormatCleaner,Marker:Marker,NewLineCommand:NewLineCommand,OutdentCommand:OutdentCommand,ParagraphCommand:ParagraphCommand,PendingFormats:PendingFormats,RangeEnumerator:RangeEnumerator,RangeUtils:RangeUtils,RestorePoint:RestorePoint,SystemHandler:SystemHandler,TypingHandler:TypingHandler,UndoRedoStack:UndoRedoStack,UnlinkCommand:UnlinkCommand}),$t.editor.prototype={value:function(n){var t=this.body,i,r;if(n===undefined)return domToXhtml(t);this.pendingFormats.clear(),n=n.replace(/<!\[CDATA\[(.*)?\]\]>/g,"<!--[CDATA[$1]]-->"),n=n.replace(/<script([^>]*)>(.*)?<\/script>/ig,"<telerik:script $1>$2<\/telerik:script>"),$.browser.mozilla&&(n=n.replace(/<p([^>]*)>(\s*)?<\/p>/ig,'<p $1><br _moz_dirty="" /><\/p>')),$.browser.msie&&parseInt($.browser.version)<9?(n="<br/>"+n,i="originalsrc",r="originalhref",n=n.replace(/href\s*=\s*(?:'|")?([^'">\s]*)(?:'|")?/,r+'="$1"'),n=n.replace(/src\s*=\s*(?:'|")?([^'">\s]*)(?:'|")?/,i+'="$1"'),t.innerHTML=n,dom.remove(t.firstChild),$(t).find("telerik\\:script,script,link,img,a").each(function(){var n=this;n[r]&&(n.setAttribute("href",n[r]),n.removeAttribute(r)),n[i]&&(n.setAttribute("src",n[i]),n.removeAttribute(i))})):(t.innerHTML=n,$.browser.msie&&normalize(t)),this.selectionRestorePoint=null,this.update()},focus:function(){this.window.focus()},update:function(n){this.textarea.value=n||this.encoded?this.encodedValue():this.value()},encodedValue:function(){return dom.encode(this.value())},createRange:function(n){return createRange(n||this.document)},getSelection:function(){return selectionFromDocument(this.document)},selectRange:function(n){this.focus();var t=this.getSelection();t.removeAllRanges(),t.addRange(n)},getRange:function(){var t=this.getSelection(),n=t.rangeCount>0?t.getRangeAt(0):this.createRange();return n.startContainer==this.document&&n.endContainer==this.document&&n.startOffset==0&&n.endOffset==0&&(n.setStart(this.body,0),n.collapse(!0)),n},selectedHtml:function(){return domToXhtml(this.getRange().cloneContents())},paste:function(n){this.clipboard.paste(n)},exec:function(n,t){var u,e,f,r="",i;n=n.toLowerCase(),this.keyboard.typingInProgress()||(this.focus(),u=this.getRange(),e=this.document.body);for(f in this.tools)if(f.toLowerCase()==n){r=this.tools[f];break}if(r){if(u=this.getRange(),!/undo|redo/i.test(n)&&r.willDelayExecution(u)){this.pendingFormats.toggle({name:n,params:t,command:r.command}),selectionChanged(this);return}if(i=r.command?r.command($.extend({range:u},t)):null,$t.trigger(this.element,"execute",{name:n,command:i}),/undo|redo/i.test(n))this.undoRedoStack[n]();else if(i&&(i.managesUndoRedo||this.undoRedoStack.push(i),i.editor=this,i.exec(),i.async)){i.change=$.proxy(function(){selectionChanged(this)},this);return}selectionChanged(this)}}},$.fn.tEditor=function(n){return $t.create(this,{name:"tEditor",init:function(n,t){return new $t.editor(n,t)},options:n})},formats={bold:[{tags:["strong"]},{tags:["span"],attr:{style:{fontWeight:"bold"}}}],italic:[{tags:["em"]},{tags:["span"],attr:{style:{fontStyle:"italic"}}}],underline:[{tags:["span"],attr:{style:{textDecoration:"underline"}}}],strikethrough:[{tags:["del"]},{tags:["span"],attr:{style:{textDecoration:"line-through"}}}],justifyLeft:[{tags:blockElements,attr:{style:{textAlign:"left"}}},{tags:["img"],attr:{style:{float:"left"}}}],justifyCenter:[{tags:blockElements,attr:{style:{textAlign:"center"}}},{tags:["img"],attr:{style:{display:"block",marginLeft:"auto",marginRight:"auto"}}}],justifyRight:[{tags:blockElements,attr:{style:{textAlign:"right"}}},{tags:["img"],attr:{style:{float:"right"}}}],justifyFull:[{tags:blockElements,attr:{style:{textAlign:"justify"}}}]},Tool.exec=function(n,t,i){n.exec(t,{value:i})},emptyFinder=function(){return{isFormatted:function(){return!1}}},localization={bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",justifyCenter:"Center text",justifyLeft:"Align text left",justifyRight:"Align text right",justifyFull:"Justify",insertUnorderedList:"Insert unordered list",insertOrderedList:"Insert ordered list",indent:"Indent",outdent:"Outdent",createLink:"Insert hyperlink",unlink:"Remove hyperlink",insertImage:"Insert image",insertHtml:"Insert HTML",fontName:"Select font family",fontNameInherit:"(inherited font)",fontSize:"Select font size",fontSizeInherit:"(inherited size)",formatBlock:"Format",style:"Styles",emptyFolder:"Empty Folder",uploadFile:"Upload",orderBy:"Arrange by:",orderBySize:"Size",orderByName:"Name",invalidFileType:'The selected file "{0}" is not valid. Supported file types are {1}.',deleteFile:'Are you sure you want to delete "{0}"?',overwriteFile:'A file with name "{0}" already exists in the current directory. Do you want to overwrite it?',directoryNotFound:"A directory with this name was not found."},$.fn.tEditor.defaults={localization:localization,formats:formats,encoded:!0,stylesheets:[],dialogOptions:{modal:!0,resizable:!1,draggable:!0,effects:{list:[{name:"toggle"}]}},fontName:[{Text:localization.fontNameInherit,Value:"inherit"},{Text:"Arial",Value:"Arial,Helvetica,sans-serif"},{Text:"Courier New",Value:"'Courier New',Courier,monospace"},{Text:"Georgia",Value:"Georgia,serif"},{Text:"Impact",Value:"Impact,Charcoal,sans-serif"},{Text:"Lucida Console",Value:"'Lucida Console',Monaco,monospace"},{Text:"Tahoma",Value:"Tahoma,Geneva,sans-serif"},{Text:"Times New Roman",Value:"'Times New Roman',Times,serif"},{Text:"Trebuchet MS",Value:"'Trebuchet MS',Helvetica,sans-serif"},{Text:"Verdana",Value:"Verdana,Geneva,sans-serif"}],fontSize:[{Text:localization.fontSizeInherit,Value:"inherit"},{Text:"1 (8pt)",Value:"xx-small"},{Text:"2 (10pt)",Value:"x-small"},{Text:"3 (12pt)",Value:"small"},{Text:"4 (14pt)",Value:"medium"},{Text:"5 (18pt)",Value:"large"},{Text:"6 (24pt)",Value:"x-large"},{Text:"7 (36pt)",Value:"xx-large"}],formatBlock:[{Text:"Paragraph",Value:"p"},{Text:"Quotation",Value:"blockquote"},{Text:"Heading 1",Value:"h1"},{Text:"Heading 2",Value:"h2"},{Text:"Heading 3",Value:"h3"},{Text:"Heading 4",Value:"h4"},{Text:"Heading 5",Value:"h5"},{Text:"Heading 6",Value:"h6"}],tools:{bold:new InlineFormatTool({key:"B",ctrl:!0,format:formats.bold}),italic:new InlineFormatTool({key:"I",ctrl:!0,format:formats.italic}),underline:new InlineFormatTool({key:"U",ctrl:!0,format:formats.underline}),strikethrough:new InlineFormatTool({format:formats.strikethrough}),undo:{key:"Z",ctrl:!0},redo:{key:"Y",ctrl:!0},insertLineBreak:new Tool({key:13,shift:!0,command:NewLineCommand}),insertParagraph:new Tool({key:13,command:ParagraphCommand}),justifyCenter:new BlockFormatTool({format:formats.justifyCenter}),justifyLeft:new BlockFormatTool({format:formats.justifyLeft}),justifyRight:new BlockFormatTool({format:formats.justifyRight}),justifyFull:new BlockFormatTool({format:formats.justifyFull}),insertUnorderedList:new ListTool({tag:"ul"}),insertOrderedList:new ListTool({tag:"ol"}),createLink:new Tool({key:"K",ctrl:!0,command:LinkCommand}),unlink:new UnlinkTool({key:"K",ctrl:!0,shift:!0}),insertImage:new Tool({command:ImageCommand}),indent:new Tool({command:IndentCommand}),outdent:new OutdentTool,insertHtml:new InsertHtmlTool,style:new StyleTool,fontName:new FontTool({cssAttr:"font-family",domAttr:"fontFamily",name:"fontName"}),fontSize:new FontTool({cssAttr:"font-size",domAttr:"fontSize",name:"fontSize"}),formatBlock:new FormatBlockTool,foreColor:new ColorTool({cssAttr:"color",domAttr:"color",name:"foreColor"}),backColor:new ColorTool({cssAttr:"background-color",domAttr:"backgroundColor",name:"backColor"})}}(jQuery);