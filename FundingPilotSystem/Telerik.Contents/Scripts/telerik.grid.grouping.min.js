(function(n){function r(t,i){return t.find("div").filter(function(){var t=n(this);if(t.children(".t-link").contents().filter(function(){if(n(this).text()===i)return n(this)}).length)return n(this)})}var t=n.telerik,u=3,i=0;t.scripts.push("telerik.grid.grouping.js"),t.grouping={},t.grouping.initialize=function(f){function c(){var t=n.map(f.$groupHeader.find(".t-group-indicator"),function(t){var i=n(t),r=i.offset().left,u=i.outerWidth();return{left:r,right:r+u,width:u,$group:i}});return{first:t[0],all:t,last:t[t.length-1]}}function e(r){var g=r.$cue.text(),w=t.eventTarget(r),h=t.touchLocation(r),k;if(!n.contains(f.element,w)||!n(w).closest(".t-grouping-header").length||f.groupFromTitle(g)&&r.$draggable.closest(".t-header").length){f.$groupDropCue.remove();return}var b=n(f.element),y=b.find("> .t-grid-toolbar"),o=y.outerHeight()+u,l=c(),a=b.closest(".t-rtl").length;if(!l.all.length){k=a?y.width()-i:i,f.$groupDropCue.css({top:o,left:k}).appendTo(f.$groupHeader);return}var s=l.first,v=l.last,p=parseInt(s.$group.css("marginLeft")),d=parseInt(s.$group.css("marginRight")),e=n.grep(l.all,function(n){return h.x>=n.left-p-d&&h.x<=n.right})[0];!e&&s&&(!a&&h.x<s.left?e=s:a&&h.x<v.left&&(e=v)),a?e?f.$groupDropCue.css({top:o,left:e.$group.position().left-p+i}).insertAfter(e.$group):f.$groupDropCue.css({top:o,left:y.width()-i}).prependTo(f.$groupHeader):e?f.$groupDropCue.css({top:o,left:e.$group.position().left-p+i}).insertBefore(e.$group):f.$groupDropCue.css({top:o,left:v.$group.position().left+v.$group.outerWidth()+d+i}).appendTo(f.$groupHeader)}function o(i){var r;if(i.$draggable.hasClass("t-header"))return r=f.columnFromTitle(i.$draggable.text()),t.dragCue(r?r.title:"");var u=n(".t-link",i.$draggable),e=u.text().substr(n(".t-icon",u).text().length),r=f.columnFromTitle(e);return t.dragCue(r?r.title:e)}function s(n){var t=n.$cue.text();return f.$groupDropCue.remove(),n.$draggable.is(".t-group-indicator")&&n.keyCode!=27?(f.unGroup(t),!1):void 0}function h(n){n.$cue.remove()}function l(n,t){for(var u=t,i=0,r=n.length;i<r;i++)if(t==n[i].Value)return n[i].Text;return t}n.extend(f,t.grouping.implementation),f.$groupDropCue=n('<div class="t-grouping-dropclue"/>'),f.$groupHeader=n("> .t-grouping-header",f.element),f.$groupHeader.length&&(new t.draggable({owner:f.$header,selector:".t-header:not(.t-group-cell,.t-hierarchy-cell)",scope:f.element.id+"-grouping",cue:o,start:function(n){var t=f.columnFromTitle(n.$draggable.text());return!!t.member&&t.groupable!==!1},stop:s,drag:e,destroy:h}),new t.draggable({owner:f.$groupHeader,selector:".t-group-indicator",scope:f.element.id+"-grouping",cue:o,stop:s,drag:e,destroy:h}),new t.droppable({owner:f.element,selector:".t-grouping-header",scope:f.element.id+"-grouping",over:function(n){t.dragCueStatus(n.$cue,"t-add")},out:function(n){t.dragCueStatus(n.$cue,"t-denied")},drop:function(t){var i=t.$cue.text(),r=f.groupFromTitle(i),o=n.inArray(r,f.groups),u=f.$groupHeader.find("div").index(f.$groupDropCue),e=o-u;(!r||f.$groupDropCue.is(":visible")&&e!=0&&e!=-1)&&f.group(i,u),f.$groupDropCue.remove()}})),f.isAjax()&&f.$groupHeader.delegate(".t-button",t.isTouch?"touchend":"click",function(t){t.preventDefault();var i=n(this).parent().find(".t-link"),r=i.text().substr(n(".t-icon",i).text().length);f.unGroup(r)}).delegate(".t-link",t.isTouch?"touchend":"click",function(t){t.preventDefault();var r=n(this),u=r.text().substr(n(".t-icon",r).text().length),i=f.groupFromTitle(u);i.order=i.order=="asc"?"desc":"asc",f.group(i.title)}),f.$groupHeader.delegate(".t-group-indicator","mouseenter",function(){f.$currentGroupItem=n(this)}).delegate(".t-group-indicator","mouseleave",function(){f.$currentGroupItem=null}),f.$tbody.delegate(".t-grouping-row .t-collapse, .t-grouping-row .t-expand","click",t.stop(function(t){t.preventDefault();var i=n(this),r=i.closest("tr");i.hasClass("t-collapse")?f.collapseGroup(r):f.expandGroup(r)})),f.groupFromTitle=function(t){return n.grep(f.groups,function(n){return n.title==t})[0]},f.expandGroup=function(t){var i=n(t),r=i.find(".t-group-cell").length;i.nextAll("tr").each(function(t,i){var u=n(i),e=u.find(".t-group-cell").length;if(e<=r)return!1;e!=r+1||u.hasClass("t-detail-row")||(u.show(),u.hasClass("t-grouping-row")&&u.find(".t-icon").hasClass("t-collapse")&&f.expandGroup(u),u.hasClass("t-master-row")&&u.find(".t-icon").hasClass("t-minus")&&u.next().show())}),i.find(".t-icon").addClass("t-collapse").removeClass("t-expand")},f.collapseGroup=function(t){var i=n(t),u=i.find(".t-group-cell").length,r=1;i.nextAll("tr").each(function(){var t=n(this),i=t.find(".t-group-cell").length;if(t.hasClass("t-grouping-row")?r++:t.hasClass("t-group-footer")&&r--,i<=u||t.hasClass("t-group-footer")&&r<0)return!1;t.hide()}),i.find(".t-icon").addClass("t-expand").removeClass("t-collapse")},f.group=function(t,i){var u,o,e,s;this.groups.length==0&&this.isAjax()&&f.$groupHeader.empty(),u=n.grep(f.groups,function(n){return n.title==t})[0],u||(o=f.columnFromTitle(t),u={order:"asc",member:o.member,title:t},f.groups.push(u)),i>=0&&(f.groups.splice(n.inArray(u,f.groups),1),f.groups.splice(i,0,u)),f.groupBy=n.map(f.groups,function(n){return n.member+"-"+n.order}).join("~"),this.isAjax()?(e=r(this.$groupHeader,t),e.length==0&&(s=(new n.telerik.stringBuilder).cat('<div class="t-group-indicator">').cat('<a href="#" class="t-link"><span class="t-icon" />').cat(t).cat("<\/a>").cat('<a class="t-button t-button-icon t-button-bare"><span class="t-icon t-group-delete">').cat(f.localization.ungroup).cat("<\/span><\/a>").cat("<\/div>").string(),e=n(s).appendTo(this.$groupHeader)),this.$groupDropCue.is(":visible")&&e.insertBefore(this.$groupDropCue),e.find(".t-link .t-icon").toggleClass("t-arrow-up-small",u.order=="asc").toggleClass("t-arrow-down-small",u.order=="desc").html("("+(u.order=="asc"?f.localization.sortedAsc:f.localization.sortedDesc)+")"),this.ajaxRequest()):this.serverRequest()},f.unGroup=function(t){var i=f.groupFromTitle(t);f.groups.splice(n.inArray(i,f.groups),1),f.groups.length==0&&f.$groupHeader.html(f.localization.groupHint),f.groupBy=n.map(f.groups,function(n){return n.member+"-"+n.order}).join("~"),f.isAjax()?(r(f.$groupHeader,t).remove(),f.ajaxRequest()):f.serverRequest()},f.normalizeColumns=function(i){var e=f.groups.length,u=i-f.$tbody.parent().find(" > colgroup > col").length,r,o,s;u!=0&&(r=f.$tbody.parent().add(f.$headerWrap.find("table")).add(f.$footer.find("table")),n.browser.msie?(u>0?(n((new t.stringBuilder).rep('<col class="t-group-col" />',u).string()).prependTo(r.find("colgroup")),n((new t.stringBuilder).rep('<th class="t-group-cell t-header">&nbsp;<\/th>',u).string()).insertBefore(r.find("th.t-header:first")),n((new t.stringBuilder).rep('<td class="t-group-cell">&nbsp;<\/td>',u).string()).insertBefore(r.find("tr.t-footer-template > td:first"))):r.find("th:lt("+Math.abs(u)+"), tr.t-footer-template > td:lt("+Math.abs(u)+")").remove().end().find("col:lt("+Math.abs(u)+")").remove(),o=[],s=0,n("table, .t-grid-bottom",f.element).each(function(){o.push(this.parentNode)}).appendTo(n("<div />")).each(function(){o[s++].appendChild(this)})):(r.find("col.t-group-col").remove(),n((new t.stringBuilder).rep('<col class="t-group-col" />',e).string()).prependTo(r.find("colgroup")),r.find("th.t-group-cell").remove(),r.find("tr.t-footer-template > td.t-group-cell").remove(),n((new t.stringBuilder).rep('<th class="t-group-cell t-header">&nbsp;<\/th>',e).string()).insertBefore(r.find("th.t-header:first")),n((new t.stringBuilder).rep('<td class="t-group-cell">&nbsp;<\/td>',e).string()).insertBefore(r.find("tr.t-footer-template > td:first"))))},f.bindGroup=function(i,r,u,e){var c=f.groups[e],s=i.value,o=n.grep(f.columns,function(n){return c.member==n.member})[0],a,v,h,y;if(o&&(o.format||o.type=="Date")&&(a=/^\/Date\((.*?)\)\/$/.exec(s),a&&(s=new Date(parseInt(a[1]))),s=t.formatString(o.format||"{0:G}",s)),u.cat('<tr class="t-grouping-row">').rep('<td class="t-group-cell"><\/td>',e).cat('<td colspan="').cat(r-e).cat('"><p class="t-reset"><a class="t-icon t-collapse" href="#"><\/a>'),o?(v=o.data?l(o.data,s):s,u.cat(o.groupHeader(n.extend({Title:c.title,Key:v},f._mapAggregates(i.aggregates[o.member]))))):u.cat(c.title+": "+s),u.cat("<\/p><\/td><\/tr>"),i.hasSubgroups)for(h=0,y=i.items.length;h<y;h++)f.bindGroup(i.items[h],r,u,e+1);else f.bindData(i.items,u,e+1);f.showGroupFooter&&(u.cat('<tr class="t-group-footer">').rep('<td class="t-group-cell"><\/td>',f.groups.length).rep('<td class="t-hierarchy-cell"><\/td>',f.detail?1:0),n.each(f.columns,function(){u.cat("<td"),u.catIf(' style="display:none;"',this.hidden),u.cat(">"),this.groupFooter&&u.cat(this.groupFooter(f._mapAggregates(i.aggregates[this.member]))),u.cat("<\/td>")}),u.cat("<\/tr>"))}}})(jQuery);