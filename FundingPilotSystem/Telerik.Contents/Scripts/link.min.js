function LinkFormatFinder(){this.findSuitable=function(n){return dom.parentOfType(n,["a"])}}function LinkFormatter(){this.finder=new LinkFormatFinder,this.apply=function(n,t){var f=textNodes(n),i,e,r,u;t.innerHTML!=undefined?(i=getMarkers(n),e=documentFromRange(n),n.deleteContents(),r=dom.create(e,"a",t),n.insertNode(r),i.length>1&&(dom.insertAfter(i[i.length-1],r),dom.insertAfter(i[1],r),dom[f.length>0?"insertBefore":"insertAfter"](i[0],r))):(u=new InlineFormatter([{tags:["a"]}],t),u.finder=this.finder,u.apply(f))}}function UnlinkCommand(n){n.formatter={toggle:function(n){new InlineFormatter([{tags:["a"]}]).remove(textNodes(n))}},Command.call(this,n)}function LinkCommand(n){var t,i;Command.call(this,n),this.async=!0,i=new LinkFormatter,this.exec=function(){function h(n){var f=$("#t-editor-link-url",r.element).val(),h,c,l;f&&f!="http://"&&(t={href:f},h=$("#t-editor-link-title",r.element).val(),h&&(t.title=h),c=$("#t-editor-link-text",r.element).val(),c!==s&&(t.innerHTML=c),l=$("#t-editor-link-target",r.element).is(":checked"),l&&(t.target="_blank"),i.apply(u,t)),e(n),o.change&&o.change()}function e(n){n.preventDefault(),r.destroy(),windowFromDocument(documentFromRange(u)).focus(),o.releaseRange(u)}var u=this.getRange(),l=u.collapsed;u=this.lockRange(!0);var n=textNodes(u),s=null,o=this;var f=n.length?i.finder.findSuitable(n[0]):null,c=n.length<=1||n.length==2&&l,r=$t.window.create($.extend({},this.editor.dialogOptions,{title:"Insert link",html:(new $.telerik.stringBuilder).cat('<div class="t-editor-dialog">').cat("<ol>").cat('<li class="t-form-text-row"><label for="t-editor-link-url">Web address<\/label><input type="text" class="t-input" id="t-editor-link-url"/><\/li>').catIf('<li class="t-form-text-row"><label for="t-editor-link-text">Text<\/label><input type="text" class="t-input" id="t-editor-link-text"/><\/li>',c).cat('<li class="t-form-text-row"><label for="t-editor-link-title">Tooltip<\/label><input type="text" class="t-input" id="t-editor-link-title"/><\/li>').cat('<li class="t-form-checkbox-row"><input type="checkbox" id="t-editor-link-target"/><label for="t-editor-link-target">Open link in new window<\/label><\/li>').cat("<\/ol>").cat('<div class="t-button-wrapper">').cat('<button class="t-dialog-insert t-button">Insert<\/button>').cat("&nbsp;or&nbsp;").cat('<a href="#" class="t-dialog-close t-link">Close<\/a>').cat("<\/div>").cat("<\/div>").string(),onClose:e})).hide().find(".t-dialog-insert").click(h).end().find(".t-dialog-close").click(e).end().find(".t-form-text-row input").keydown(function(n){n.keyCode==13?h(n):n.keyCode==27&&e(n)}).end().find("#t-editor-link-url").val(f?f.getAttribute("href",2):"http://").end().find("#t-editor-link-text").val(n.length>0?n.length==1?n[0].nodeValue:n[0].nodeValue+n[1].nodeValue:"").end().find("#t-editor-link-title").val(f?f.title:"").end().find("#t-editor-link-target").attr("checked",f?f.target=="_blank":!1).end().show().data("tWindow").center();c&&n.length>0&&(s=$("#t-editor-link-text",r.element).val()),$("#t-editor-link-url",r.element).focus().select()},this.redo=function(){var n=this.lockRange(!0);i.apply(n,t),this.releaseRange(n)}}function UnlinkTool(n){Tool.call(this,$.extend(n,{command:UnlinkCommand}));var t=new InlineFormatFinder([{tags:["a"]}]);this.init=function(n){n.attr("unselectable","on").addClass("t-state-disabled")},this.update=function(n,i){n.toggleClass("t-state-disabled",!t.isFormatted(i)).removeClass("t-state-hover")}}