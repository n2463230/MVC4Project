(function(n){function c(t){return n.map(r(t),function(n){return n.name}).join(", ")}function r(n){var t=n[0];return t.files?s(t.files):[{name:g(t.value),extension:l(t.value),size:null}]}function s(t){return n.map(t,function(n){return d(n)})}function d(n){var t=n.name||n.fileName;return{name:t,extension:l(t),size:n.size||n.fileSize,rawFile:n}}function l(n){var t=n.match(k);return t?t[0]:""}function g(n){var t=n.lastIndexOf("\\");return t!=-1?n.substr(t+1):n}function a(i,r,u){if(r._supportsRemove()){var f=i.data("fileNames"),e=n.map(f,function(n){return n.name});r._submitRemove(e,u,function(n,u,e){r._removeFileEntry(i),t.trigger(r.wrapper,"success",{operation:"remove",files:f,response:n,XMLHttpRequest:e})},function(n){var i=t.trigger(r.wrapper,"error",{operation:"remove",files:f,XMLHttpRequest:n});b("Server response: "+n.responseText),i||r._alert("Error! Remove operation failed. Unexpected response - see console.")})}}function v(t,i,r){try{var u=n.parseJSON(t)}catch(f){r();return}i(u)}function y(n){n.stopPropagation(),n.preventDefault()}function p(n,t,i){var r,u;n.bind("dragenter",function(){t(),u=new Date,r||(r=setInterval(function(){var n=new Date-u;n>100&&(i(),clearInterval(r),r=null)},100))}).bind("dragover",function(){u=new Date})}function w(n){return n.children(".t-icon").is(".t-loading, .t-success, .t-fail")}function b(n){typeof console!="undefined"&&console.log&&console.log(n)}function i(t){return n(t.target).closest(".t-file")}function h(){var t={};return n("input[name^='__RequestVerificationToken']").each(function(){t[this.name]=this.value}),t}var u,t=n.telerik,k=/\.([^\.]+)$/,f,e,o;t.scripts.push("telerik.upload.js"),t.upload=function(i,r){var s,h;n.extend(this,r),this.element=i,this.name=i.name,s=n(i),this.wrapper=s.closest(".t-upload"),this.wrapper.length==0&&(this.wrapper=this._wrapInput(s)),this._setActiveInput(s),this.toggle(this.enabled),s.closest("form").bind({submit:n.proxy(this._onParentFormSubmit,this),reset:n.proxy(this._onParentFormReset,this)}),this._module=this.async.saveUrl!=u?this._getSupportsFormData()?new o(this):new e(this):new f(this),this._getSupportsDrop()&&this._setupDropZone(),this.wrapper.delegate(".t-upload-action","click",n.proxy(this._onFileAction,this)).delegate(".t-upload-selected","click",n.proxy(this._onUploadSelected,this)).delegate(".t-file","t:progress",n.proxy(this._onFileProgress,this)).delegate(".t-file","t:upload-success",n.proxy(this._onUploadSuccess,this)).delegate(".t-file","t:upload-error",n.proxy(this._onUploadError,this)),t.bind(this.wrapper,{load:this.onLoad,select:this.onSelect,upload:this.onUpload,success:this.onSuccess,error:this.onError,complete:this.onComplete,cancel:this.onCancel,remove:this.onRemove}),h=n(this.wrapper).data("tUpload",this),n(i).bind("load",function(){t.trigger(h,"load")})},t.upload.prototype={enable:function(){this.toggle(!0)},disable:function(){this.toggle(!1)},toggle:function(n){n=typeof n=="undefined"?n:!n,this.wrapper.toggleClass("t-state-disabled",n)},_addInput:function(t){t.insertAfter(this.element).data("tUpload",this),n(this.element).hide().removeAttr("id"),this._setActiveInput(t)},_setActiveInput:function(t){var i=this.wrapper;this.element=t,t.attr("multiple",this._getSupportsMultiple()?this.multiple:!1).attr("autocomplete","off").click(function(n){i.hasClass("t-state-disabled")&&n.preventDefault()}).change(n.proxy(this._onInputChange,this))},_onInputChange:function(i){var u=n(i.target),f=t.trigger(this.wrapper,"select",{files:r(u)});f||u.trigger("t:select")},_onDrop:function(i){var f=i.originalEvent.dataTransfer,r=f.files,u;y(i),r.length>0&&(u=t.trigger(this.wrapper,"select",{files:s(r)}),u||n(".t-dropzone",this.wrapper).trigger("t:select",[r]))},_enqueueFile:function(t,i){var r=n(".t-upload-files",this.wrapper),u,f;return r.length==0&&(r=n("<ul class='t-upload-files t-reset'><\/ul>").appendTo(this.wrapper),this.showFileList||r.hide()),u=n(".t-file",r),f=n("<li class='t-file'><span class='t-icon'><\/span><span class='t-filename' title='"+t+"'>"+t+"<\/span><\/li>").appendTo(r).data(i),this.multiple||u.trigger("t:remove"),f},_removeFileEntry:function(t){var i=t.closest(".t-upload-files");n(".t-file",i).length==1?(i.remove(),this._hideUploadButton()):t.remove()},_setFileAction:function(n,t){var i={remove:"t-delete",cancel:"t-cancel",retry:"t-retry"};i.hasOwnProperty(t)&&(this._clearFileAction(n),n.append(this._renderAction(i[t],this.localization[t]).addClass("t-upload-action")))},_setFileState:function(n,t){var u={uploading:{cssClass:"t-loading",text:this.localization.statusUploading},uploaded:{cssClass:"t-success",text:this.localization.statusUploaded},failed:{cssClass:"t-fail",text:this.localization.statusFailed}},i=u[t],r;i&&(r=n.children(".t-icon").text(i.text),r[0].className="t-icon "+i.cssClass)},_renderAction:function(t,i){return t!=""?n("<button type='button' class='t-button t-button-icontext'><span class='t-icon "+t+"'><\/span>"+i+"<\/button>"):n("<button type='button' class='t-button'>"+i+"<\/button>")},_clearFileAction:function(n){n.find(".t-upload-action").remove()},_onFileAction:function(i){if(!this.wrapper.hasClass("t-state-disabled")){var e=n(i.target).closest(".t-upload-action"),u=e.find(".t-icon"),r=e.closest(".t-file"),f={files:r.data("fileNames")};u.hasClass("t-delete")?t.trigger(this.wrapper,"remove",f)||r.trigger("t:remove",f.data):u.hasClass("t-cancel")?(t.trigger(this.wrapper,"cancel",f),r.trigger("t:cancel")):u.hasClass("t-retry")&&r.trigger("t:retry")}return!1},_onUploadSelected:function(){return this.wrapper.trigger("t:saveSelected"),!1},_onFileProgress:function(t,i){var r=n(".t-progress-status",t.target);r.length==0&&(r=n("<span class='t-progress'><span class='t-progress-status' style='width: 0;'><\/span><\/span>").appendTo(n(".t-filename",t.target)).find(".t-progress-status")),r.width(i+"%")},_onUploadSuccess:function(n,r,u){var f=i(n);this._setFileState(f,"uploaded"),t.trigger(this.wrapper,"success",{files:f.data("fileNames"),response:r,operation:"upload",XMLHttpRequest:u}),this._supportsRemove()?this._setFileAction(f,"remove"):this._clearFileAction(f),this._checkAllComplete()},_onUploadError:function(n,r){var u=i(n),f;this._setFileState(u,"failed"),this._setFileAction(u,"retry"),f=t.trigger(this.wrapper,"error",{operation:"upload",files:u.data("fileNames"),XMLHttpRequest:r}),b("Server response: "+r.responseText),f||this._alert("Error! Upload failed. Unexpected server response - see console."),this._checkAllComplete()},_showUploadButton:function(){var t=n(".t-upload-selected",this.wrapper);t.length==0&&(t=this._renderAction("",this.localization.uploadSelectedFiles).addClass("t-upload-selected")),this.wrapper.append(t)},_hideUploadButton:function(){n(".t-upload-selected",this.wrapper).remove()},_onParentFormSubmit:function(){var r=this,t=r.element,i;t.trigger("t:abort"),t.value||(i=n(t),i.attr("disabled","disabled"),window.setTimeout(function(){i.removeAttr("disabled")},0))},_onParentFormReset:function(){n(".t-file",this.wrapper).trigger("t:remove")},_getSupportsFormData:function(){return typeof FormData!="undefined"},_getSupportsMultiple:function(){return!n.browser.opera},_getSupportsDrop:function(){var n=this._getUserAgent().toLowerCase(),t=/chrome/.test(n),i=!t&&/safari/.test(n),r=i&&/windows/.test(n);return!r&&this._getSupportsFormData()&&this.async.saveUrl!=u},_getUserAgent:function(){return navigator.userAgent},_setupDropZone:function(){n(".t-upload-button",this.wrapper).wrap("<div class='t-dropzone'><\/div>");var t=n(".t-dropzone",this.wrapper).append(n("<em>"+this.localization.dropFilesHere+"<\/em>")).bind({dragenter:y,dragover:function(n){n.preventDefault()},drop:n.proxy(this._onDrop,this)});p(t,function(){t.addClass("t-dropzone-hovered")},function(){t.removeClass("t-dropzone-hovered")}),p(n(document),function(){t.addClass("t-dropzone-active")},function(){t.removeClass("t-dropzone-active")})},_supportsRemove:function(){return this.async.removeUrl!=u},_submitRemove:function(t,i,r,u){var f=n.extend(i,h());f.fileNames=t,n.ajax({type:"POST",dataType:"json",url:this.async.removeUrl,traditional:!0,data:f,success:r,error:u})},_alert:function(n){alert(n)},_wrapInput:function(n){return n.wrap("<div class='t-widget t-upload'><div class='t-button t-upload-button'><\/div><\/div>"),n.closest(".t-button").append("<span>"+this.localization.select+"<\/span>"),n.closest(".t-upload")},_checkAllComplete:function(){n(".t-file .t-icon.t-loading",this.wrapper).length==0&&t.trigger(this.wrapper,"complete")}},n.fn.tUpload=function(n){return t.create(this,{name:"tUpload",init:function(n,i){return new t.upload(n,i)},options:n})},n.fn.tUpload.defaults={enabled:!0,multiple:!0,showFileList:!0,async:{},localization:{select:"Select...",cancel:"Cancel",retry:"Retry",remove:"Remove",uploadSelectedFiles:"Upload files",dropFilesHere:"drop files here to upload",statusUploading:"uploading",statusUploaded:"uploaded",statusFailed:"failed"}},f=function(t){this.name="syncUploadModule",this.element=t.wrapper,this.upload=t,this.element.bind("t:select",n.proxy(this.onSelect,this)).bind("t:remove",n.proxy(this.onRemove,this)).closest("form").attr("enctype","multipart/form-data").attr("encoding","multipart/form-data")},f.prototype={onSelect:function(t){var i=this.upload,r=n(t.target),u;i._addInput(r.clone().val("")),u=i._enqueueFile(c(r),{relatedInput:r}),i._setFileAction(u,"remove")},onRemove:function(n){var t=i(n);t.data("relatedInput").remove(),this.upload._removeFileEntry(t)}},e=function(t){this.name="iframeUploadModule",this.element=t.wrapper,this.upload=t,this.iframes=[],this.element.bind("t:select",n.proxy(this.onSelect,this)).bind("t:cancel",n.proxy(this.onCancel,this)).bind("t:retry",n.proxy(this.onRetry,this)).bind("t:remove",n.proxy(this.onRemove,this)).bind("t:saveSelected",n.proxy(this.onSaveSelected,this)).bind("t:abort",n.proxy(this.onAbort,this))},e.prototype={onSelect:function(t){var i=this.upload,u=n(t.target),r=this.prepareUpload(u);i.async.autoUpload?this.performUpload(r):(i._supportsRemove()&&this.upload._setFileAction(r,"remove"),i._showUploadButton())},prepareUpload:function(t){var i=this.upload,e=n(i.element),s=i.async.saveField||t.attr("name"),u,o,f;return i._addInput(t.clone().val("")),t.attr("name",s),u=this.createFrame(i.name+"_"+this.iframes.length),this.registerFrame(u),o=this.createForm(i.async.saveUrl,u.attr("name")).append(e),f=i._enqueueFile(c(t),{frame:u,relatedInput:e,fileNames:r(t)}),u.data({form:o,file:f}),f},performUpload:function(i){var u={files:i.data("fileNames")},r=i.data("frame"),f=this.upload,e,o,s;if(t.trigger(f.wrapper,"upload",u))f._removeFileEntry(r.data("file")),this.cleanupFrame(r),this.unregisterFrame(r);else{f._hideUploadButton(),r.appendTo(document.body),e=r.data("form").appendTo(document.body),u.data=n.extend({},u.data,h());for(o in u.data)s=e.find("input[name='"+o+"']"),s.length==0&&(s=n("<input>",{type:"hidden",name:o}).prependTo(e)),s.val(u.data[o]);f._setFileAction(i,"cancel"),f._setFileState(i,"uploading");r.one("load",n.proxy(this.onIframeLoad,this));e[0].submit()}},onSaveSelected:function(){var t=this;n(".t-file",this.element).each(function(){var i=n(this),r=w(i);r||t.performUpload(i)})},onIframeLoad:function(t){var r=n(t.target),i;try{i=r.contents().text()}catch(t){i="Error trying to get server response: "+t}this.processResponse(r,i)},processResponse:function(t,i){var u=t.data("file"),f=this,r={responseText:i};v(i,function(i){n.extend(r,{statusText:"OK",status:"200"}),u.trigger("t:upload-success",[i,r]),f.cleanupFrame(t),f.unregisterFrame(t)},function(){n.extend(r,{statusText:"error",status:"500"}),u.trigger("t:upload-error",[r])})},onCancel:function(t){var i=n(t.target).data("frame");this.stopFrameSubmit(i),this.cleanupFrame(i),this.unregisterFrame(i),this.upload._removeFileEntry(i.data("file"))},onRetry:function(n){var t=i(n);this.performUpload(t)},onRemove:function(n,t){var r=i(n),u=r.data("frame");u?(this.unregisterFrame(u),this.upload._removeFileEntry(r),this.cleanupFrame(u)):a(r,this.upload,t)},onAbort:function(){var t=this.element,i=this;n.each(this.iframes,function(){n("input",this.data("form")).appendTo(t),i.stopFrameSubmit(this[0]),this.data("form").remove(),this.remove()}),this.iframes=[]},createFrame:function(t){return n("<iframe name='"+t+"' id='"+t+"' style='display:none;' />")},createForm:function(t,i){return n("<form enctype='multipart/form-data' method='POST' action='"+t+"' target='"+i+"'/>")},stopFrameSubmit:function(n){typeof n.stop!="undefined"?n.stop():n.document&&(n.document.execCommand("Stop"),n.contentWindow.location.href=n.contentWindow.location.href)},registerFrame:function(n){this.iframes.push(n)},unregisterFrame:function(t){this.iframes=n.grep(this.iframes,function(n){return n.attr("name")!=t.attr("name")})},cleanupFrame:function(n){var t=n.data("form");n.data("file").data("frame",null),setTimeout(function(){t.remove(),n.remove()},1)}},o=function(t){this.name="formDataUploadModule",this.element=t.wrapper,this.upload=t,this.element.bind("t:select",n.proxy(this.onSelect,this)).bind("t:cancel",n.proxy(this.onCancel,this)).bind("t:remove",n.proxy(this.onRemove,this)).bind("t:retry",n.proxy(this.onRetry,this)).bind("t:saveSelected",n.proxy(this.onSaveSelected,this)).bind("t:abort",n.proxy(this.onAbort,this))},o.prototype={onSelect:function(t,i){var r=this.upload,f=this,u=n(t.target),e=i?s(i):this.getInputFiles(u),o=this.prepareUpload(u,e);n.each(o,function(){r.async.autoUpload?f.performUpload(this):(r._supportsRemove()&&r._setFileAction(this,"remove"),r._showUploadButton())})},prepareUpload:function(t,i){var r=this.enqueueFiles(i);return t.is("input")&&(n.each(r,function(){n(this).data("relatedInput",t)}),t.data("relatedFileEntries",r),this.upload._addInput(t.clone().val(""))),r},enqueueFiles:function(n){var u=this.upload,t;for(fileEntries=[],t=0;t<n.length;t++){var i=n[t],f=i.name,r=u._enqueueFile(f,{fileNames:[i]});r.data("formData",this.createFormData(n[t])),fileEntries.push(r)}return fileEntries},getInputFiles:function(n){return r(n)},performUpload:function(i){var u=this.upload,e=i.data("formData"),r={files:i.data("fileNames")},f;if(t.trigger(this.element,"upload",r))this.removeFileEntry(i);else{u._setFileAction(i,"cancel"),u._hideUploadButton(),r.data=n.extend({},r.data,h());for(f in r.data)e.append(f,r.data[f]);u._setFileState(i,"uploading"),this.postFormData(this.upload.async.saveUrl,e,i)}},onSaveSelected:function(){var t=this;n(".t-file",this.element).each(function(){var i=n(this),r=w(i);r||t.performUpload(i)})},onCancel:function(n){var t=i(n);this.stopUploadRequest(t),this.removeFileEntry(t)},onRetry:function(n){var t=i(n);this.performUpload(t)},onRemove:function(n,t){var r=i(n);r.children(".t-icon").is(".t-success")?a(r,this.upload,t):this.removeFileEntry(r)},postFormData:function(n,t,i){var r=new XMLHttpRequest,u=this;i.data("request",r),r.addEventListener("load",function(n){u.onRequestSuccess.call(u,n,i)},!1),r.addEventListener("error",function(n){u.onRequestError.call(u,n,i)},!1),r.upload.addEventListener("progress",function(n){u.onRequestProgress.call(u,n,i)},!1),r.open("POST",n),r.send(t)},createFormData:function(n){var t=new FormData,i=this.upload;return t.append(i.async.saveField||i.name,n.rawFile),t},onRequestSuccess:function(n,t){var i=n.target,r=this;v(i.responseText,function(n){t.trigger("t:upload-success",[n,i]),t.trigger("t:progress",[100]),r.cleanupFileEntry(t)},function(){t.trigger("t:upload-error",[i])})},onRequestError:function(n,t){var i=n.target;t.trigger("t:upload-error",[i])},cleanupFileEntry:function(t){var i=t.data("relatedInput"),r=!0;i&&(n.each(i.data("relatedFileEntries"),function(){this.parent().length>0&&this[0]!=t[0]&&(r=r&&this.children(".t-icon").is(".t-success"))}),r&&i.remove()),t.data("formData",null)},removeFileEntry:function(n){this.cleanupFileEntry(n),this.upload._removeFileEntry(n)},onRequestProgress:function(n,t){var i=Math.round(n.loaded*100/n.total);t.trigger("t:progress",[i])},stopUploadRequest:function(n){n.data("request").abort()}}})(jQuery);