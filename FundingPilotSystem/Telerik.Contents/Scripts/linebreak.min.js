function ParagraphCommand(n){Command.call(this,n),this.exec=function(){var t=this.getRange(),h=documentFromRange(t),o,u,n,c=$.browser.msie?"":'<br _moz_dirty="" />',f,r,i,e,s,l="p,h1,h2,h3,h4,h5,h6".split(","),a=dom.parentOfType(t.startContainer,l),v=dom.parentOfType(t.endContainer,l),p=a&&!v||!a&&v;if(t.deleteContents(),r=dom.create(h,"a"),t.insertNode(r),normalize(r.parentNode),i=dom.parentOfType(r,["li"]),e=dom.parentOfType(r,"h1,h2,h3,h4,h5,h6".split(",")),i?(s=t.cloneRange(),s.selectNode(i),textNodes(s).length==0&&(f=dom.create(h,"p"),i.nextSibling&&split(s,i.parentNode),dom.insertAfter(f,i.parentNode),dom.remove(i.parentNode.childNodes.length==1?i.parentNode:i),f.innerHTML=c,n=f)):e&&!r.nextSibling&&(f=dom.create(h,"p"),dom.insertAfter(f,e),f.innerHTML=c,dom.remove(r),n=f),!n){i||e||new BlockFormatter([{tags:["p"]}]).apply([r]),t.selectNode(r),o=dom.parentOfType(r,[i?"li":e?dom.name(e):"p"]),split(t,o,p),u=o.previousSibling,dom.is(u,"li")&&u.firstChild&&!dom.is(u.firstChild,"br")&&(u=u.firstChild),n=o.nextSibling,dom.is(n,"li")&&n.firstChild&&!dom.is(n.firstChild,"br")&&(n=n.firstChild),dom.remove(o);function y(n){n.firstChild&&dom.is(n.firstChild,"br")&&dom.remove(n.firstChild),isDataNode(n)&&n.nodeValue==""&&(n=n.parentNode),n&&!dom.is(n,"img")&&n.innerHTML==""&&(n.innerHTML=c)}y(u),y(n),normalize(u)}normalize(n),dom.is(n,"img")?t.setStartBefore(n):t.selectNodeContents(n),t.collapse(!0),dom.scrollTo(n),selectRange(t)}}function NewLineCommand(n){Command.call(this,n),this.exec=function(){var t=this.getRange(),n,i;t.deleteContents(),n=dom.create(documentFromRange(t),"br"),t.insertNode(n),normalize(n.parentNode),$.browser.msie||n.nextSibling&&!dom.isWhitespace(n.nextSibling)||(i=n.cloneNode(!0),i.setAttribute("_moz_dirty",""),dom.insertAfter(i,n)),t.setStartAfter(n),t.collapse(!0),selectRange(t)}}